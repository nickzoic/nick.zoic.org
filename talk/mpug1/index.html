<html>
  <head>
    <link rel="stylesheet" href="flip.css"/>
    <script src="flip.js"></script>
    <title>ESP32 and MicroPython</title>
  </head>
  <body>

	   <!-- hey yeah I wrote this in HTML because it seemed like a good idea at the time.
	             The whole flip.js thing is mine too, feel free to use it yourself though. -->
		     
    <div class="slide">
      <h1>ESP32 and MicroPython</h1>
      <h3>Nick Moore<br/>
        <a href="https://twitter.com/mnemote/">@mnemote</a></h3>
    </div>

    <div class="slide">
       <h1>ESP32</h1>
       <img class="whiteborder" src="img/esp32-package.jpg" height="50%"/>
       <!-- XXX find a better photo -->
       <p class="small">original image: <a href="https://aliexpress.com">aliexpress.com</a></p>
    </div>

    <div class="slide">
       <img src="img/esp32-HD-1024.jpg" height="90%"/>
       <p class="small">original image: <a href="https://zeptobars.com/en/read/Espressif-ESP32-Wi-Fi-Bluetooth-2.4Ghz-ISM">zeptobars.com</a></p>
    </div>

    <div class="slide">
       <img src="img/esp32-rf-HD-1024.jpg" height="90%"/>
       <p class="small">original image: <a href="https://zeptobars.com/en/read/Espressif-ESP32-Wi-Fi-Bluetooth-2.4Ghz-ISM">zeptobars.com</a></p>
    </div>

    <div class="slide">
       <img src="img/esp32-zoom-1024.jpg" height="90%"/>
       <p class="small">original image: <a href="https://zeptobars.com/en/read/Espressif-ESP32-Wi-Fi-Bluetooth-2.4Ghz-ISM">zeptobars.com</a></p>
    </div>

    <div class="slide">
       <p>Originally the ESP8266 came to prominence as a WiFi controller for AVR
          and similar, but ...</p>
       <table>
        <tr><th>Arduino</th><th><b>ESP8266</b></th><th>RPi 2</th></tr>
	      <tr><td>AVR<br/>ATMega328P</td><td><b>Tensilica<br/>Xtensa LX106</b></td><td>ARM<br/>Cortex A53</td></tr>
        <tr><td>8 bit</td><td><b>32 bit</b></td><td>32 bit</td></tr>
        <tr><td>1 core</td><td><b>1 core</b></td><td>4 core</td></tr>
        <tr><td>20 MHz</td><td><b>80-160 MHz</b></td><td>900 MHz</td></tr>
        <tr><td>2 KB RAM</td><td><b>160 KB RAM</b></td><td>1 GB RAM</td></tr>
        <tr><td>32 KB Flash</td><td><b>4 MB Flash</b></td><td>MicroSDHC</td></tr>
       </table>
    </div>

    <div class="slide">
       <h3>New: ESP32</h3>
       <table>
        <tr><th>Arduino</th><th>ESP8266</th><th><b>ESP32</b></th><th>RPi 2</th></tr>
	      <tr><td>AVR<br/>ATMega328P</td><td>Tensilica<br/>Xtensa LX106</td><td><b>Tensilica<br/>Xtensa LX6</b></td><td>ARM<br/>Cortex A53</td></tr>
        <tr><td>8 bit</td><td>32 bit</td><td><b>32 bit</b></td><td>32 bit</td></tr>
        <tr><td>1 core</td><td>1 core</td><td><b>2 core</b></td><td>4 core</td></tr>
        <tr><td>20 MHz</td><td>80-160 MHz</td><td><b>240 MHz</b></td><td>900 MHz</td></tr>
        <tr><td>2 KB RAM</td><td>160 KB RAM</td><td><b>520 KB RAM</b></td><td>1 GB RAM</td></tr>
        <tr><td>32 KB Flash</td><td>4 MB Flash</td><td><b>16 MB Flash</b></td><td>MicroSDHC</td></tr>
       </table>
    </div>

    <div class="slide">
        <h3>ESP32 Features</h3>

	<ul>
		<li>WiFi 2.4GHz</li>
		<li>Bluetooth (BLE)</li>
		<li>Many I/O lines</li>
		<li>ADC, DAC, PWM, Capacitive Touch</li>
		<li>ULP Processor, Hall effect sensor</li>
	</ul>
    </div>

    <div class="slide">
       <h3>ESP32 Modules</h3>
       <p>WROOM-32 or ESP-32S</p>
       <img src="img/esp-wroom-32.jpg"/>
       <p class="small">original image: <a href="https://espressif.com/">espressif.com</a></p>
    </div>

    <div class="slide">
       <h3>ESP32 Boards</h3>
       <p>Sparkfun ESP32 Thing / ESP32-DevKitC / AdaFruit HUZZAH32</p>
       <img src="img/esp32-devkitc-adafruit.jpg" width="30%"/>
       <img src="img/sparkfun-esp32-thing.jpg" width="30%"/>
       <img src="img/esp32-adafruit.jpg" width="30%"/>
       <p class="small">original images: <a href="https://sparkfun.com">sparkfun.com</a> and
         <a href="https://espressif.com/">espressif.com</a> and
         <a href="https://adafruit.com/">adafruit.com</a></p>
    </div>

    <div class="slide">
       <h3>Programming the ESP32</h3>
       <ul>
         <li>Serial programming mode to flash memory
            <br/>by pulling GPIO0 low at reset</li>
         <li>Any of the usual RS232-TTL converters</li>
	 <li>2.2 to 3.6V at 250mA ...</li>
         <li>... too low current gives unpredictable results</li>
	 <li>... too high voltage gives predictable failure!</li>
       </ul>
    </div>

    <div class="slide">
       <h3>esptool</h3>
       <p><a href="https://github.com/espressif/esptool">github: espressif/esptool</a></p>
       
       <pre class="medium"><b>$</b> git clone https://github.com/espressif/esptool.git
<b>$</b> cd esptool
<b>$</b> python setup.py install</pre>

       <p>pypi and ubuntu repositories are <b>not</b> up to date here ...</p>
    </div>

    <div class="slide">
      <h3>ESP-IDF</h3>
       <p><a href="https://github.com/espressif/esp-idf">github: espressif/esp-idf</a></p>
       <p><em>IoT Development Framework</em></p>
       <p>C SDK for building programs to run on ESP32</p>
       <p>Contains LWIP, examples, instructions for building toolchain</p>
      <pre class="medium"><b>$</b> git clone --recursive https://github.com/espressif/esp-idf.git</b></pre>
    </div>

    <div class="slide">
       <h3>MicroPython</h3>
       <img class="whiteborder" src="img/micropython.jpg" height="50%"/>
       <h4><a href="https://micropython.org/">micropython.org</a></h4>
    </div>


    <div class="slide">
        <h3>MicroPython</h3>
	          <ul>
			           <li>Python 3.4</li>
				   <li>Quite a lot of the standard libraries</li>
				            <li>Written in C99</li>
					             <li>MIT-licensed</li>
						            </ul>
							       </div>
							       
     <div class="slide">
         <h3>MicroPython Platforms</h3>
        <ul>
           <li><a href="https://store.micropython.org/#/features">PyBoard</a> (ARM Cortex)</li>
           <li>16-bit PIC</li>
            <li>ESP8266</li>
           <li><b>ESP32</b></li>
        </ul>
	<p>For more background, see<br/><a href="https://www.youtube.com/watch?v=Zm08hXeuv-I">Damien's talk about the Kickstarter campaign</a><br/>from PyConAU 2016</p>
	<p>Development of esp32 port was sponsored in part by<br/><a href="http://www.microbric.com/">Microbric Pty Ltd</a></p>
     </div>    

    <div class="slide">     
       <h3>Getting MicroPython</h3>
       <ul>
         <li>Download firmware from <a href="https://micropython.org/download#esp32">https://micropython.org/download#esp32</a></li>
       </ul>
       <p>Use esptool to load onto board:</p>
<pre><b>$</b> export ESPTOOL_PORT=/dev/ttyUSB0
<b>$</b> export ESPTOOL_BAUD=115200
<b>$</b> export ESPTOOL_FS=detect
<b>$</b> esptool write_flash 0 \
    esp32-20170604-v1.8.7-964-g62d40e8b.bin</pre>
<ul><li>May need <tt>--flash_mode dio</tt></li>
	<li>May be able to use <tt>ESPTOOL_BAUD=921600</tt></li></ul>
    </div>

    <div class="slide">
        <h3>MicroPython REPL</h3>
        <pre class="medium"><b>$</b> miniterm.py /dev/ttyUSB0 115200 --raw
<b>MicroPython v1.8.7-964-g62d40e8b on 2017-06-04; ESP module with ESP32
Type "help()" for more information.</b>
<b>&gt;&gt;&gt;</b> dir()
<b>['uos', 'gc', '__name__', 'bdev']</b>
<b>&gt;&gt;&gt;</b> print("Hello, World!")
<b>Hello, World!</b>
<b>&gt;&gt;&gt;</b> 2**100
<b>1267650600228229401496703205376</b>
<b>&gt;&gt;&gt;</b> import os
<b>&gt;&gt;&gt;</b> os.listdir(".")
<b>['boot.py']</b>
<b>&gt;&gt;&gt;</b></pre>
    </div>

    <div class="slide">
        <h3>MicroPython I/O &mdash; 1</h3>
        <pre class="medium"><b>&gt;&gt;&gt;</b> import machine
<b>&gt;&gt;&gt;</b> import time
<b>&gt;&gt;&gt;</b> pin5 = machine.Pin(5, machine.Pin.OUT)
<b>&gt;&gt;&gt;</b> while True:
<b>...</b>     pin5.value(0)
<b>...</b>     time.sleep(0.5)
<b>...</b>     pin5.value(1)
<b>...</b>     time.sleep(0.5)</pre>
      <img src="img/blinky-esp32.gif" height="50%"/>
    </div>

    <div class="slide">
        <h3>MicroPython I/O &mdash; 2</h3>
        <pre class="medium">import machine

class Servo:
    def __init__(self, pin):
        self.pwm = machine.PWM(pin)
        self.pwm.freq(50)

    def set(self, pos):
        pulse_us = 1000 + 1000 * min(1,max(pos,0))
        self.pwm.duty(int(pulse_us * self.pwm.freq() * 0.001024))

pin5 = machine.Pin(5, machine.Pin.OUT)
srv5 = Servo(pin5)
srv5.set(0.25)
srv5.set(0.9)</pre>
    </div>

    <div class="slide">
        <h3>MicroPython WiFi</h3>
        <pre class="medium"><b>&gt;&gt;&gt;</b> import network
<b>&gt;&gt;&gt;</b> sta_if = network.WLAN(network.STA_IF)
<b>&gt;&gt;&gt;</b> sta_if.active(True)
<b>&gt;&gt;&gt;</b> sta_if.scan()
<b>&gt;&gt;&gt;</b> sta_if.isconnected()
<b>False</b>
<b>&gt;&gt;&gt;</b> sta_if.connect("my_ap", "my_password")
<b>&gt;&gt;&gt;</b> sta_if.isconnected()
<b>True</b>
<b>&gt;&gt;&gt;</b> sta_if.ifconfig()
<b>('10.107.1.124', '255.255.255.0', '10.107.1.1', '10.107.1.1')</b>

    </div>

    <div class="slide">
        <h3>MicroPython Sockets</h3>
        <pre class="medium"><b>&gt;&gt;&gt;</b> import socket
<b>&gt;&gt;&gt;</b> sock = socket.socket(socket.AF_INET)
<b>&gt;&gt;&gt;</b> sock.bind(('0.0.0.0', 80))
<b>&gt;&gt;&gt;</b> sock.listen(5)
<b>&gt;&gt;&gt;</b> sock.accept()
<b>(&lt;socket state=2 timeout=-1 incoming=0 off=0&gt;, ('10.107.1.4', 37464))</b></pre>
    </div>

    <div class="slide">
	    <h3>Copying Files</h3>

	    <p><a href="https://github.com/nickzoic/mpy-utils">github: nickzoic/mpy-utils</a></p>
	    <ul>
	    <li>mpy-upload : copy files in to a device using only the REPL.</li>
	    <li>mpy-sync : copy whole directory structure.</li>
	    <li>mpy-fuse : mount a device into the filesystem using FUSE ...</li>
	    <li>mpy-watch : watch a directory for changes and send the diffs</li>
	    </ul>
    </div>

    <div class="slide">
       <h3>What <em>doesn't</em> MicroPython have?</h3>
       <ul>
         <li>An operating system</li>
         <li>Multiprocessing</li>
         <li>Much memory to play with</li>
         <li>Debugger / Profiler</li>
       </ul>
    </div>

    <div class="slide">
<h3>Contributing to MicroPython</h3>
    <p><a href="https://github.com/micropython/micropython-esp32">github: micropython/micropython-esp32</a></p>
    <pre class="medium"><b>$</b> git clone https://github.com/micropython/micropython-esp32
<b>$</b> git clone --recursive https://github.com/espressif/esp-idf 
<b>$</b> wget https://dl.espressif.com/dl/xtensa-esp32-elf-linux64-1.22.0-59.tar.gz
<b>$</b> tar xzf xtensa-esp32-elf-linux64-1.22.0-59.tar.gz 
<b>$</b> export ESPIDF=`realpath esp-idf`
<b>$</b> export PATH=`realpath xtensa-esp32-elf/bin`:$PATH
<b>$</b> cd micropython-esp32
<b>$</b> make -C mpy-cross
<b>$</b> make -C esp32
    </pre>

    </div>

    <div class="slide">
       <h3>Summary</h3>
       <p>If you're interested in Microcontrollers / IoT / Robotics:</p>
       <ul>
          <li>ESP32 is about the cheapest</li>
          <li>MicroPython is about the easiest</li>
       </ul>
    </div>

    <div class="slide">
       <h3>PyCon AU</h3>
       <img src="img/pycon-logo-mel.png" width="50%"/>
       <p class="small">original image: <a href="https://2017.pycon-au.org/">2017.pycon-au.org</a></p>
    </div>

    <div class="slide">
      <h3>Questions / Comments</h3>
      <p>Nick Moore<br/>Mnemote Pty Ltd</p>
      <ul>
        <li><a href="mailto:nick@mnemote.com">nick@mnemote.com</a></li>
        <li><a href="http://mnemote.com/">http://mnemote.com/</a></li>
        <li><a href="https://twitter.com/mnemote/">@mnemote</a></li>
      </ul>
      <p>Slides:</p>
      <ul>
         <li><a href="http://nick.zoic.org/talk/mpug1/">http://nick.zoic.org/talk/mpug1/</a></li>
      </ul>
      <p class="small">Content and images &copy; Mnemote Pty Ltd except where otherwise noted</p>
    </div>

    <div class="footer">
      <span><img class="logo" src="img/mnemote-logo-color.svg"/>Nick Moore &lt;nick@mnemote.com&gt; for <a href="https://wiki.python.org/moin/MelbournePUG">Melbourne Python Users Group</a></span>
    </div>

  </body>
</html>
